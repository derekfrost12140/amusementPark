<!DOCTYPE html>
<html>
<head>
    <title>Show My Location and Default Location</title>
    <style>
        #map {
            height: 500px;
            width: 80%;
        }
    </style>
</head>
<body>

<h3>My Location and Default Location on Map</h3>
<div id="map"></div>

<button onclick="showAllMarkers()">Show All Rides</button>
<button onclick="hideAllMarkers()">Hide All Rides</button>
<button onclick="showMarkersByRating('A')">Show Category A Rides</button>
<button onclick="showMarkersByRating('B')">Show Category B Rides</button>
<button onclick="showMarkersByRating('C')">Show Category C Rides</button>

<script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database.js"></script>

<script>
    // Initialize Firebase
    const firebaseConfig = { 
        apiKey: "AIzaSyBn7xE-jaEuixzyDROnbHrQo6-YtOR5LaU", 
        authDomain: "amusement-park-4039d.firebaseapp.com", 
        projectId: "amusement-park-4039d", 
        storageBucket: "amusement-park-4039d.firebasestorage.app", 
        messagingSenderId: "625618396056", 
        appId: "1:625618396056:web:ff2907be3a1958ed9041ed", 
        measurementId: "G-6QHBHT0PPE" 
    };
    const app = firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    var map, userMarker, defaultMarker;
    var markers = [];
    var infoWindow;
    var defaultLocation = { lat: 32.7561025211987, lng: -97.07243375722175 };

    // Show all markers
    function showAllMarkers() {
        markers.forEach(marker => marker.setMap(map));
    }

    // Hide all markers
    function hideAllMarkers() {
        markers.forEach(marker => marker.setMap(null));
    }

    // Show markers by accessRating
    function showMarkersByRating(rating) {
        markers.forEach(marker => {
            if (marker.accessRating === rating) {
                marker.setMap(map);
            } else {
                marker.setMap(null);
            }
        });
    }

    // Add a marker based on data from Firebase
    function addMarkerFromData(location, title, accessRating) {
        const marker = new google.maps.Marker({
            position: location,
            map: map,
            title: title,
            accessRating: accessRating
        });
        markers.push(marker);

        google.maps.event.addListener(marker, 'click', function() {
            if (infoWindow) infoWindow.close();
            infoWindow = new google.maps.InfoWindow({ content: title });
            infoWindow.open(map, marker);
        });
    }

    // Load markers from Firebase and add them to the map
    function loadMarkersFromFirebase() {
        database.ref('rides').on('child_added', (snapshot) => {
            const data = snapshot.val();
            const location = { lat: data.lat, lng: data.lng };
            addMarkerFromData(location, data.name, data.accessRating);
        });
    }

    // Initialize and add the map
    function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
            zoom: 16,
            center: defaultLocation
        });

        // Create marker for the default location
        defaultMarker = new google.maps.Marker({
            position: defaultLocation,
            map: map
        });
        markers.push(defaultMarker);

        // Load all markers from Firebase
        loadMarkersFromFirebase();

        // Start tracking user location
        trackUserLocation();
    }

    // Track user location and update marker
    function trackUserLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.watchPosition(
                updateUserLocation,
                showError,
                { enableHighAccuracy: true }
            );
        } else {
            alert("Geolocation is not supported by this browser.");
        }
    }

    // Update user's position on the map
    function updateUserLocation(position) {
        const userLocation = {
            lat: position.coords.latitude,
            lng: position.coords.longitude
        };

        if (!userMarker) {
            userMarker = new google.maps.Marker({
                position: userLocation,
                map: map,
                title: 'My Location',
                icon: 'http://maps.google.com/mapfiles/ms/icons/blue-dot.png'
            });
            markers.push(userMarker);
        } else {
            userMarker.setPosition(userLocation);
        }

        const bounds = new google.maps.LatLngBounds();
        bounds.extend(userMarker.getPosition());
        bounds.extend(defaultMarker.getPosition());
        map.fitBounds(bounds);
    }

    // Geolocation error handling
    function showError(error) {
        switch (error.code) {
            case error.PERMISSION_DENIED:
                alert("User denied the request for Geolocation.");
                break;
            case error.POSITION_UNAVAILABLE:
                alert("Location information is unavailable.");
                break;
            case error.TIMEOUT:
                alert("The request to get user location timed out.");
                break;
            case error.UNKNOWN_ERROR:
                alert("An unknown error occurred.");
                break;
        }
    }
</script>

<!-- Load the Google Maps API -->
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCIj_NqWo62GER45QxwIjmrTLR82rHT83U&callback=initMap"></script>

</body>
</html>