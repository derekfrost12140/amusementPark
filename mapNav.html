<!DOCTYPE html>
<html>
<head>
    <title>Show My Location and Default Location</title>
    <style>
        #map {
            height: 500px;
            width: 80%;
        }
    </style>
</head>
<body>

<h3>My Location and Default Location on Map</h3>
<div id="map"></div>

<button onclick="showAllMarkers()">Show All Rides</button>
<button onclick="hideAllMarkers()">Hide All Rides</button>
<button onclick="showMarkersByRating('A')">Show Category A Rides</button>
<button onclick="showMarkersByRating('B')">Show Category B Rides</button>
<button onclick="showMarkersByRating('C')">Show Category C Rides</button>

<script>
var map, userMarker, defaultMarker, directionsService, directionsRenderer;
var markers = [];
var infoWindow;
var defaultLocation = { lat: 32.7561025211987, lng: -97.07243375722175 };

function showMarkersByRating(rating) {
    markers.forEach(marker => {
        if (marker.accessRating === rating) {
            marker.setMap(map);
        } else {
            marker.setMap(null);
        }
    });
}

function showAllMarkers() {
    markers.forEach(marker => marker.setMap(map));
}

function hideAllMarkers() {
    markers.forEach(marker => marker.setMap(null));
}

function addMarker(location, title, accessRating) {
    const marker = new google.maps.Marker({
        position: location,
        map: map,
        title: title,
        accessRating: accessRating
    });
    markers.push(marker);

    google.maps.event.addListener(marker, 'click', function() {
        if (infoWindow) infoWindow.close();
        infoWindow = new google.maps.InfoWindow({ content: title });
        infoWindow.open(map, marker);

        // If userMarker exists, start navigation
        if (userMarker) {
            displayRoute(userMarker.getPosition(), marker.getPosition());
        }
    });
}

function initMap() {
    map = new google.maps.Map(document.getElementById('map'), {
        zoom: 16,
        center: defaultLocation
    });

    directionsService = new google.maps.DirectionsService();
    directionsRenderer = new google.maps.DirectionsRenderer({ map: map });

    defaultMarker = new google.maps.Marker({
        position: defaultLocation,
        map: map
    });
    markers.push(defaultMarker);

    addMarker({lat: 32.75697483075996, lng: -97.06877913374088}, 'Aquaman', 'A');
    addMarker({lat: 32.75856227274212, lng: -97.06667492209952}, 'Batman', 'B');
    addMarker({lat: 32.75762547473778, lng: -97.06712999326611}, 'Batwing', 'C');
    addMarker({lat: 32.75781394213248, lng: -97.0674662049114}, 'Boomtown', 'A');
    addMarker({lat: 32.757045925450036, lng: -97.07213885213747}, 'Boot Scootin', 'B');
    addMarker({lat: 32.75637875518393, lng: -97.06927534792608}, 'Bugs Bunny Cloud Bouncer', 'C');
    addMarker({lat: 32.75728725280709, lng: -97.06627646258323}, 'Catwoman Whip', 'A');
    addMarker({lat: 32.756835534991026, lng: -97.06895716747873}, 'Daffy Duck Bucket Blasters', 'C');
    addMarker({lat: 32.75567214202478, lng: -97.0719046049028}, 'El Diablo', 'A');
    addMarker({lat: 32.755561834817264, lng: -97.0707825277106}, 'El Sombrero', 'B');
    addMarker({lat: 32.75324750222072, lng: -97.0679110590334}, 'Judge Roy Scream', 'C');
    addMarker({lat: 32.75791929344962, lng: -97.0677074337446}, 'Gunslinger', 'A');
    addMarker({lat: 32.75742142423297, lng: -97.06661494630468}, 'Justice League: Battle for Metropolis', 'B');
    addMarker({lat: 32.755669332272035, lng: -97.07129106781014}, 'La Fiesta de las Tazas', 'C');
    addMarker({lat: 32.75548781011889, lng: -97.07155711109925}, 'La Vibora', 'A');
    addMarker({lat: 32.75784178390764, lng: -97.06661224784125}, 'Mr. Freeze', 'B');
    addMarker({lat: 32.758886637131965, lng: -97.07057433567623}, 'Shock Wave', 'C');
    addMarker({lat: 32.758384840744206, lng: -97.06868454595156}, 'Superman', 'A');
    addMarker({lat: 32.7570749439281, lng: -97.07255299151078}, 'Texas Depot', 'B');
    addMarker({lat: 32.75676784036096, lng: -97.0658927520594}, 'Texas SkyScreamer', 'C');
    addMarker({lat: 32.75685106292408, lng: -97.0652765520594}, 'Riddler', 'A');
    addMarker({lat: 32.7557677102804, lng: -97.07418512037097}, 'Titan', 'B');

    trackUserLocation();
}

function trackUserLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.watchPosition(
            updateUserLocation,
            showError,
            { enableHighAccuracy: true }
        );
    } else {
        alert("Geolocation is not supported by this browser.");
    }
}

function updateUserLocation(position) {
    var userLocation = { lat: position.coords.latitude, lng: position.coords.longitude };
    if (!userMarker) {
        userMarker = new google.maps.Marker({
            position: userLocation,
            map: map,
            title: 'My Location',
            icon: 'http://maps.google.com/mapfiles/ms/icons/blue-dot.png'
        });
        markers.push(userMarker);
    } else {
        userMarker.setPosition(userLocation);
    }
}

// Function to display route between user location and clicked marker
function displayRoute(origin, destination) {
    directionsService.route(
        {
            origin: origin,
            destination: destination,
            travelMode: google.maps.TravelMode.DRIVING // Set travel mode (DRIVING, WALKING, etc.)
        },
        function(response, status) {
            if (status === google.maps.DirectionsStatus.OK) {
                directionsRenderer.setDirections(response);
            } else {
                alert('Could not display route due to: ' + status);
            }
        }
    );
}

function showError(error) {
    switch (error.code) {
        case error.PERMISSION_DENIED:
            alert("User denied the request for Geolocation.");
            break;
        case error.POSITION_UNAVAILABLE:
            alert("Location information is unavailable.");
            break;
        case error.TIMEOUT:
            alert("The request to get user location timed out.");
            break;
        case error.UNKNOWN_ERROR:
            alert("An unknown error occurred.");
            break;
    }
}
</script>

<script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCIj_NqWo62GER45QxwIjmrTLR82rHT83U&callback=initMap">
</script>

</body>
</html>
