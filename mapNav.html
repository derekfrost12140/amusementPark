<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="mapstyles.css">
    <title>Map</title>
    <style>
        #map {
            height: 500px;
            width: 100%;
        }
    </style>
</head>
<body>

<h3>Rides Map</h3>
<div id="map"></div>

<script>
// Global variables to hold map and markers
var map;
var markers = [];
var infoWindow;

function initMap() {
    // Default location for the map center
    var defaultLocation = { lat: 32.7561025211987, lng: -97.07243375722175 };

    // Initialize map
    map = new google.maps.Map(document.getElementById('map'), {
        zoom: 16,
        center: defaultLocation
    });

    infoWindow = new google.maps.InfoWindow();

    // Add all the markers
    addMarker({ lat: 32.75694774660049, lng: -97.06858634954958 }, 'Aquaman', ['A', 'C']);
    addMarker({ lat: 32.75867956518985, lng: -97.0665944558818 }, 'Batman', ['B']);
    addMarker({ lat: 32.757562316535875, lng: -97.067054891455 }, 'Batwing', ['C']);
    addMarker({ lat: 32.75775980664769, lng: -97.06749839143542 }, 'Boomtown', ['A', 'B']);
    addMarker({ lat: 32.757154197253314, lng: -97.0720959368577 }, 'Boot Scootin', ['A']);
    addMarker({ lat: 32.75637875518429, lng: -97.06841704130149 }, 'Bugs Cloud Bouncer', ['A']);
    addMarker({ lat: 32.75726920754156, lng: -97.06628719155061 }, 'Catwoman Whip', ['A']);
    addMarker({ lat: 32.75687916891457, lng: -97.06778361202024 }, 'Cloud Bouncer', ['A']);
    addMarker({ lat: 32.75912726546584, lng: -97.06800230384427 }, 'Bucket Blasters', ['A']);
    addMarker({ lat: 32.755825529397704, lng: -97.07200652921023 }, 'El Diablo', ['A']);
    addMarker({ lat: 32.755489433620255, lng: -97.0709131848416 }, 'Sombrero', ['A']);
    addMarker({ lat: 32.75323847916851, lng: -97.06802371184325 }, 'Judge Roy Scream', ['A']);
    addMarker({ lat: 32.757991473958874, lng: -97.0677503492011 }, 'Gunslinger', ['A']);
    addMarker({ lat: 32.75731315275531, lng: -97.06689389616429 }, 'Justice League', ['A']);
    addMarker({ lat: 32.755669332272035, lng: -97.07129106781014 }, 'Tea Cups', ['A']);
    addMarker({ lat: 32.75548781011889, lng: -97.07155711109925 }, 'La Vibora', ['A']);
    addMarker({ lat: 32.75784178390764, lng: -97.06661224784125 }, 'Mr. Freeze', ['A']);
    addMarker({ lat: 32.758886637131965, lng: -97.07057433567623 }, 'Shock Wave', ['A']);
    addMarker({ lat: 32.758384840744206, lng: -97.06868454595156 }, 'Superman', ['A']);
    addMarker({ lat: 32.7570749439281, lng: -97.07255299151078 }, 'Texas Depot', ['A', 'B']);
    addMarker({ lat: 32.75676784036096, lng: -97.0658927520594 }, 'Texas SkyScreamer', ['C', 'D']);
    addMarker({ lat: 32.75685106292408, lng: -97.0652765520594 }, 'Riddler', ['A']);
    addMarker({ lat: 32.7557677102804, lng: -97.07418512037097 }, 'Titan', ['D']);
    addMarker({ lat: 32.756423818467, lng: -97.0707233713286 }, 'Silver Star Carousel', ['A', 'B']);
    addMarker({ lat: 32.758398856366156, lng: -97.07091809461619}, 'Oil Derrick', ['A', 'B']);

    // Load settings and apply visibility based on user preferences
    applySettings();
}

// Function to add a marker
function addMarker(location, title, categories) {
    var marker = new google.maps.Marker({
        position: location,
        map: map,
        title: title,
        categories: categories // Store categories in marker
    });

    markers.push(marker);

    // Add a click event to show marker info
    google.maps.event.addListener(marker, 'click', function () {
        infoWindow.setContent(title);
        infoWindow.open(map, marker);
    });
}

// Function to apply settings from localStorage
function applySettings() {
    var showCategoryA = localStorage.getItem('showCategoryA') === 'true';
    var showCategoryB = localStorage.getItem('showCategoryB') === 'true';
    var showCategoryC = localStorage.getItem('showCategoryC') === 'true';
    var showCategoryD = localStorage.getItem('showCategoryD') === 'true';

    markers.forEach(function (marker) {
        var categories = marker.categories;
        if (
            (categories.includes('A') && showCategoryA) ||
            (categories.includes('B') && showCategoryB) ||
            (categories.includes('C') && showCategoryC) ||
            (categories.includes('D') && showCategoryD)
        ) {
            marker.setMap(map);
        } else {
            marker.setMap(null);
        }
    });
}

// Listen for storage changes and update the map accordingly
window.addEventListener('storage', function (event) {
    if (
        event.key === 'showCategoryA' ||
        event.key === 'showCategoryB' ||
        event.key === 'showCategoryC' ||
        event.key === 'showCategoryD'
    ) {
        applySettings();
    }
});

// Load the map when the page is ready
window.onload = initMap;

</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCIj_NqWo62GER45QxwIjmrTLR82rHT83U&callback=initMap&libraries=places" async defer></script>

</body>
</html>